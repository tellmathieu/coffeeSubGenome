Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 20
Rules claiming more threads will be scaled down.
Job stats:
job                 count
----------------  -------
all                     1
initialETraining        2
refineParameters        2
total                   5

Select jobs to execute...

[Wed Aug 21 19:00:29 2024]
rule initialETraining:
    input: /home/tmathieu/miniforge3/envs/liftnew/config/species/subEugenioides/subEugenioides_parameters.cfg, /home/tmathieu/miniforge3/envs/liftnew/config/species/subEugenioides/subEugenioides_weightmatrix.txt, /home/tmathieu/miniforge3/envs/liftnew/config/species/subEugenioides/subEugenioides_metapars.cfg, /home/tmathieu/coffeaArabica/RNAseqBasedPrediction/subEugenioides/bonafide.gb
    output: /data/data2/homes/tmathieu/testingCofSM/subEugenioides/subEugenioides_bonafide.out, /data/data2/homes/tmathieu/testingCofSM/subEugenioides/bonafide.gb
    jobid: 2
    reason: Missing output files: /data/data2/homes/tmathieu/testingCofSM/subEugenioides/bonafide.gb; Updated input files: /home/tmathieu/miniforge3/envs/liftnew/config/species/subEugenioides/subEugenioides_parameters.cfg
    wildcards: subgenome=subEugenioides
    resources: tmpdir=/tmp


		cp /home/tmathieu/coffeaArabica/RNAseqBasedPrediction/subEugenioides/bonafide.gb /data/data2/homes/tmathieu/testingCofSM/subEugenioides/bonafide.gb

		etraining 			--species=subEugenioides 			/data/data2/homes/tmathieu/testingCofSM/subEugenioides/bonafide.gb 			&> /data/data2/homes/tmathieu/testingCofSM/subEugenioides/subEugenioides_bonafide.out
	

[Wed Aug 21 19:00:29 2024]
rule initialETraining:
    input: /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_parameters.cfg, /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_weightmatrix.txt, /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_metapars.cfg, /home/tmathieu/coffeaArabica/RNAseqBasedPrediction/subCanephora/bonafide.gb
    output: /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out, /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb
    jobid: 40
    reason: Missing output files: /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb; Code has changed since last execution
    wildcards: subgenome=subCanephora
    resources: tmpdir=/tmp


		cp /home/tmathieu/coffeaArabica/RNAseqBasedPrediction/subCanephora/bonafide.gb /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb

		etraining 			--species=subCanephora 			/data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb 			&> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out
	
[Wed Aug 21 19:00:35 2024]
Finished job 40.
1 of 5 steps (20%) done
Select jobs to execute...

[Wed Aug 21 19:00:35 2024]
rule refineParameters:
    input: /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out, /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb, /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_parameters.cfg
    output: /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt, /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb
    jobid: 39
    reason: Missing output files: /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb; Input files updated by another job: /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb, /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out
    wildcards: subgenome=subCanephora
    resources: tmpdir=/tmp


		errors=$(grep -c "Variable stopCodonExcludedFromCDS set right" /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out)
		totalLoci=$(grep -c LOCUS /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb)

		errorRate=$(($errors/$totalLoci))

		echo "Initial Check for Bad Training Genes" > /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo "# of errors stopCodonExcludedFromCDS:" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo $errors >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo "total # of loci in bonafide.gb:" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo $totalLoci >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt

		# In Alternate Protocol 4, authors stated that stopCodonExcludedFromCDS 
		# did not need to be set to TRUE unless the number of errors 
		# wasn't a minority.
		# I set this as 20%, but this would be up for debate, a correct percentage wasn't indicated by the authors.
		if [ $errorRate -gt 0.2 ]; then
			echo "Need to refine parameters" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
			sed -i 's/stopCodonExcludedFromCDS false/stopCodonExcludedFromCDS true/g' /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_parameters.cfg
			echo "stopCodonExcludedFromCDS is changed to TRUE" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
 		else
			echo "Good to go for stopCodonExcludedFromCDS!" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt

		# 2nd part of refining parameters - already done by Thales, but included here to make sure
		etraining --species=subCanephora /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb 2>&1 				| grep "in sequence" 				| perl -pe s/.*n sequence (\S+):.*/$1/' 				| sort -u > subCanephora/subCanephora.bad.lst
		filterGenes.pl subCanephora/subCanephora.bad.lst /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb > /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb

		remainingLoci=$(grep -c LOCUS /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb)
		echo $remainingLoci >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
	
[Wed Aug 21 19:00:35 2024]
Error in rule refineParameters:
    jobid: 39
    input: /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out, /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb, /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_parameters.cfg
    output: /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt, /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb
    shell:
        
		errors=$(grep -c "Variable stopCodonExcludedFromCDS set right" /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_bonafide.out)
		totalLoci=$(grep -c LOCUS /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb)

		errorRate=$(($errors/$totalLoci))

		echo "Initial Check for Bad Training Genes" > /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo "# of errors stopCodonExcludedFromCDS:" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo $errors >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo "total # of loci in bonafide.gb:" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
		echo $totalLoci >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt

		# In Alternate Protocol 4, authors stated that stopCodonExcludedFromCDS 
		# did not need to be set to TRUE unless the number of errors 
		# wasn't a minority.
		# I set this as 20%, but this would be up for debate, a correct percentage wasn't indicated by the authors.
		if [ $errorRate -gt 0.2 ]; then
			echo "Need to refine parameters" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
			sed -i 's/stopCodonExcludedFromCDS false/stopCodonExcludedFromCDS true/g' /home/tmathieu/miniforge3/envs/liftnew/config/species/subCanephora/subCanephora_parameters.cfg
			echo "stopCodonExcludedFromCDS is changed to TRUE" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
 		else
			echo "Good to go for stopCodonExcludedFromCDS!" >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt

		# 2nd part of refining parameters - already done by Thales, but included here to make sure
		etraining --species=subCanephora /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb 2>&1 				| grep "in sequence" 				| perl -pe s/.*n sequence (\S+):.*/$1/' 				| sort -u > subCanephora/subCanephora.bad.lst
		filterGenes.pl subCanephora/subCanephora.bad.lst /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb > /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb

		remainingLoci=$(grep -c LOCUS /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.gb /data/data2/homes/tmathieu/testingCofSM/subCanephora/bonafide.f.gb)
		echo $remainingLoci >> /data/data2/homes/tmathieu/testingCofSM/subCanephora/subCanephora_error_check.txt
	
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

[Wed Aug 21 19:00:36 2024]
Finished job 2.
2 of 5 steps (40%) done
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: .snakemake/log/2024-08-21T190028.618332.snakemake.log
